# éƒ¨ç½²æ–‡æ¡£æ€»è§ˆ ğŸ“š

æ¬¢è¿ä½¿ç”¨æ™ºèƒ½é€‰å‹ç³»ç»Ÿï¼æœ¬æ–‡æ¡£æä¾›å®Œæ•´çš„éƒ¨ç½²æŒ‡å—å’Œèµ„æºç´¢å¼•ã€‚

---

## ğŸ“– æ–‡æ¡£å¯¼èˆª

### å¿«é€Ÿå¼€å§‹
- **[QUICK_DEPLOY.md](./QUICK_DEPLOY.md)** - âš¡ 5åˆ†é’Ÿå¿«é€Ÿéƒ¨ç½²æŒ‡å—ï¼ˆæ¨èæ–°æ‰‹ï¼‰
- **[BUILD_CHECKLIST.md](./BUILD_CHECKLIST.md)** - âœ… æ‰“åŒ…éƒ¨ç½²æ£€æŸ¥æ¸…å•

### è¯¦ç»†æ–‡æ¡£
- **[DEPLOYMENT.md](./DEPLOYMENT.md)** - ğŸ“˜ å®Œæ•´éƒ¨ç½²æ–‡æ¡£ï¼ˆåŒ…å«æ‰€æœ‰éƒ¨ç½²æ–¹å¼ï¼‰
- **[ENV_SETUP.md](./ENV_SETUP.md)** - âš™ï¸ ç¯å¢ƒé…ç½®è¯´æ˜

### åŠŸèƒ½æ–‡æ¡£
- **[DATA_INTEGRATION.md](./DATA_INTEGRATION.md)** - ğŸ”Œ æ•°æ®é›†æˆè¯´æ˜
- **[SAVE_CONFIRMATION_FEATURE.md](./SAVE_CONFIRMATION_FEATURE.md)** - ğŸ’¾ ä¿å­˜ç¡®è®¤åŠŸèƒ½è¯´æ˜

---

## ğŸš€ å¿«é€Ÿéƒ¨ç½²ï¼ˆ3æ­¥ä¸Šçº¿ï¼‰

### ç¬¬1æ­¥ï¼šé…ç½®ç¯å¢ƒå˜é‡

åˆ›å»º `.env.production` æ–‡ä»¶ï¼š
```bash
cat > .env.production << EOF
NEXT_PUBLIC_API_URL=https://demo.langcore.cn
NEXT_PUBLIC_API_TOKEN=ä½ çš„API_TOKEN
NEXT_PUBLIC_WORKFLOW_ID=ä½ çš„WORKFLOW_ID
EOF
```

### ç¬¬2æ­¥ï¼šæ„å»ºé¡¹ç›®

```bash
# å®‰è£…ä¾èµ–
pnpm install --prod

# æ„å»º
pnpm build
```

### ç¬¬3æ­¥ï¼šå¯åŠ¨åº”ç”¨

```bash
# æ–¹å¼1: ç›´æ¥å¯åŠ¨
pnpm start

# æ–¹å¼2: ä½¿ç”¨ PM2ï¼ˆæ¨èï¼‰
npm install -g pm2
pm2 start ecosystem.config.js
```

**å®Œæˆï¼** è®¿é—® `http://localhost:3000`

---

## ğŸ“¦ æ„å»ºå‘½ä»¤

### å¼€å‘ç¯å¢ƒ
```bash
pnpm dev          # å¯åŠ¨å¼€å‘æœåŠ¡å™¨
pnpm lint         # ä»£ç æ£€æŸ¥
```

### ç”Ÿäº§ç¯å¢ƒ
```bash
pnpm build        # æ„å»ºç”Ÿäº§ç‰ˆæœ¬
pnpm start        # å¯åŠ¨ç”Ÿäº§æœåŠ¡å™¨
```

### æ£€æŸ¥æ„å»ºäº§ç‰©
```bash
# Windows
dir .next /s

# Linux/Mac
du -sh .next
ls -lh .next
```

---

## ğŸ—‚ï¸ éƒ¨ç½²æ–‡ä»¶è¯´æ˜

### æ ¸å¿ƒæ–‡ä»¶
- `package.json` - é¡¹ç›®ä¾èµ–å’Œè„šæœ¬
- `next.config.mjs` - Next.js é…ç½®
- `.env.production` - ç”Ÿäº§ç¯å¢ƒå˜é‡ï¼ˆéœ€è‡ªè¡Œåˆ›å»ºï¼‰

### éƒ¨ç½²é…ç½®æ–‡ä»¶
- `ecosystem.config.js` - PM2 é…ç½®ï¼ˆå·²æä¾›ï¼‰
- `nginx.conf.example` - Nginx é…ç½®ç¤ºä¾‹ï¼ˆå·²æä¾›ï¼‰
- `deploy.sh` - è‡ªåŠ¨åŒ–éƒ¨ç½²è„šæœ¬ï¼ˆå·²æä¾›ï¼‰
- `env.example.txt` - ç¯å¢ƒå˜é‡æ¨¡æ¿ï¼ˆå·²æä¾›ï¼‰

### æ„å»ºäº§ç‰©
- `.next/` - Next.js æ„å»ºè¾“å‡º
- `public/` - é™æ€èµ„æº
- `node_modules/` - ä¾èµ–åŒ…ï¼ˆä¸éœ€è¦ä¸Šä¼ åˆ°ç”Ÿäº§æœåŠ¡å™¨ï¼Œåœ¨æœåŠ¡å™¨ä¸Šå®‰è£…ï¼‰

---

## ğŸŒ éƒ¨ç½²æ–¹å¼å¯¹æ¯”

| æ–¹å¼ | éš¾åº¦ | æ€§èƒ½ | æ¨èåœºæ™¯ |
|------|------|------|----------|
| **ç›´æ¥è¿è¡Œ** (`pnpm start`) | â­ | â­â­ | å¼€å‘æµ‹è¯• |
| **PM2** | â­â­ | â­â­â­â­ | ç”Ÿäº§ç¯å¢ƒï¼ˆæ¨èï¼‰ |
| **PM2 + Nginx** | â­â­â­ | â­â­â­â­â­ | ç”Ÿäº§ç¯å¢ƒ + åŸŸå |
| **Docker** | â­â­â­â­ | â­â­â­â­ | å®¹å™¨åŒ–éƒ¨ç½² |
| **é™æ€å¯¼å‡º** | â­â­ | â­â­â­ | CDN éƒ¨ç½²ï¼ˆä¸æ¨èæœ¬é¡¹ç›®ï¼‰ |

---

## ğŸ› ï¸ ç¯å¢ƒè¦æ±‚

### æœåŠ¡å™¨è¦æ±‚
- **æ“ä½œç³»ç»Ÿ**: Linux (Ubuntu 20.04+), CentOS 7+, Windows Server
- **Node.js**: >= 18.17.0
- **å†…å­˜**: >= 2GBï¼ˆæ¨è 4GB+ï¼‰
- **ç£ç›˜**: >= 5GB å¯ç”¨ç©ºé—´
- **ç½‘ç»œ**: éœ€è¦è®¿é—®å¤–ç½‘ï¼ˆä¸‹è½½ä¾èµ–å’Œè®¿é—® APIï¼‰

### æœ¬åœ°å¼€å‘è¦æ±‚
- **Node.js**: >= 18.17.0
- **pnpm**: >= 8.0.0ï¼ˆæˆ– npm >= 9.0.0ï¼‰
- **Git**: ç”¨äºç‰ˆæœ¬æ§åˆ¶

### æ£€æŸ¥ç¯å¢ƒ
```bash
# æ£€æŸ¥ Node.js ç‰ˆæœ¬
node -v

# æ£€æŸ¥ pnpm ç‰ˆæœ¬
pnpm -v

# æ£€æŸ¥å¯ç”¨å†…å­˜
free -h  # Linux
wmic OS get FreePhysicalMemory  # Windows

# æ£€æŸ¥ç£ç›˜ç©ºé—´
df -h  # Linux
wmic logicaldisk get size,freespace,caption  # Windows
```

---

## ğŸ”§ å¸¸ç”¨é…ç½®

### ç¯å¢ƒå˜é‡è¯´æ˜

| å˜é‡å | è¯´æ˜ | ç¤ºä¾‹å€¼ |
|--------|------|--------|
| `NEXT_PUBLIC_API_URL` | åç«¯ API åœ°å€ | `https://demo.langcore.cn` |
| `NEXT_PUBLIC_API_TOKEN` | API è®¤è¯ä»¤ç‰Œ | `your_token_here` |
| `NEXT_PUBLIC_WORKFLOW_ID` | Workflow ID | `your_workflow_id` |

âš ï¸ **æ³¨æ„**: 
- æ‰€æœ‰å®¢æˆ·ç«¯ä½¿ç”¨çš„ç¯å¢ƒå˜é‡å¿…é¡»ä»¥ `NEXT_PUBLIC_` å¼€å¤´
- ä¿®æ”¹ç¯å¢ƒå˜é‡åéœ€è¦é‡æ–°æ„å»º: `pnpm build`

### PM2 é…ç½®è¯´æ˜

`ecosystem.config.js` ä¸»è¦é…ç½®é¡¹ï¼š
```js
{
  name: 'intelligent-selection-system',  // åº”ç”¨åç§°
  instances: 'max',                      // å®ä¾‹æ•°ï¼ˆCPU æ ¸å¿ƒæ•°ï¼‰
  exec_mode: 'cluster',                  // é›†ç¾¤æ¨¡å¼
  max_memory_restart: '1G',              // å†…å­˜é™åˆ¶
}
```

### Nginx é…ç½®è¦ç‚¹

- **ç«¯å£æ˜ å°„**: 80/443 â†’ 3000
- **åå‘ä»£ç†**: å°†è¯·æ±‚è½¬å‘åˆ° Next.js
- **é™æ€èµ„æºç¼“å­˜**: æå‡æ€§èƒ½
- **Gzip å‹ç¼©**: å‡å°‘ä¼ è¾“å¤§å°
- **é™æµä¿æŠ¤**: é˜²æ­¢ API æ»¥ç”¨

---

## ğŸ“Š éƒ¨ç½²æµç¨‹å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   æœ¬åœ°å¼€å‘      â”‚
â”‚  (pnpm dev)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ä»£ç æäº¤      â”‚
â”‚   (Git Push)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   æœåŠ¡å™¨æ‹‰å–    â”‚
â”‚  (Git Pull)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å®‰è£…ä¾èµ–       â”‚
â”‚ (pnpm install)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   æ„å»ºé¡¹ç›®      â”‚
â”‚  (pnpm build)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å¯åŠ¨åº”ç”¨      â”‚
â”‚    (PM2)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Nginx ä»£ç†     â”‚
â”‚  (å¯é€‰)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   HTTPS é…ç½®    â”‚
â”‚  (Certbot)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ å…¸å‹éƒ¨ç½²åœºæ™¯

### åœºæ™¯ 1: æœ¬åœ°æµ‹è¯•
```bash
pnpm install
pnpm dev
# è®¿é—® http://localhost:3000
```

### åœºæ™¯ 2: å•æœåŠ¡å™¨éƒ¨ç½²ï¼ˆæ— åŸŸåï¼‰
```bash
pnpm install --prod
pnpm build
pm2 start ecosystem.config.js
# è®¿é—® http://æœåŠ¡å™¨IP:3000
```

### åœºæ™¯ 3: å•æœåŠ¡å™¨éƒ¨ç½²ï¼ˆæœ‰åŸŸåï¼‰
```bash
# 1. æ„å»ºåº”ç”¨
pnpm install --prod && pnpm build && pm2 start ecosystem.config.js

# 2. é…ç½® Nginx
sudo cp nginx.conf.example /etc/nginx/sites-available/intelligent-selection
# ä¿®æ”¹åŸŸå
sudo ln -s /etc/nginx/sites-available/intelligent-selection /etc/nginx/sites-enabled/
sudo systemctl reload nginx

# 3. é…ç½® HTTPS
sudo certbot --nginx -d your-domain.com
```

### åœºæ™¯ 4: Docker éƒ¨ç½²
```bash
# ä¿®æ”¹ next.config.mjs æ·»åŠ  output: 'standalone'
docker-compose up -d
```

---

## ğŸ” æ•…éšœæ’æŸ¥

### é—®é¢˜ 1: æ„å»ºå¤±è´¥
```bash
# æ¸…ç†ç¼“å­˜é‡è¯•
rm -rf .next node_modules
pnpm install
pnpm build
```

### é—®é¢˜ 2: åº”ç”¨æ— æ³•å¯åŠ¨
```bash
# æŸ¥çœ‹æ—¥å¿—
pm2 logs intelligent-selection-system

# æ£€æŸ¥ç«¯å£å ç”¨
lsof -i :3000  # Linux
netstat -ano | findstr :3000  # Windows
```

### é—®é¢˜ 3: 502 Bad Gateway
```bash
# æ£€æŸ¥åº”ç”¨çŠ¶æ€
pm2 status

# æ£€æŸ¥ Nginx é…ç½®
sudo nginx -t

# é‡å¯æœåŠ¡
pm2 restart all
sudo systemctl reload nginx
```

### é—®é¢˜ 4: ç¯å¢ƒå˜é‡ä¸ç”Ÿæ•ˆ
```bash
# ç¡®è®¤æ–‡ä»¶å­˜åœ¨
cat .env.production

# é‡æ–°æ„å»º
pnpm build

# é‡å¯åº”ç”¨
pm2 restart all
```

---

## ğŸ“ è·å–å¸®åŠ©

### æ–‡æ¡£èµ„æº
1. ğŸ“˜ [Next.js éƒ¨ç½²æ–‡æ¡£](https://nextjs.org/docs/deployment)
2. ğŸ“— [PM2 æ–‡æ¡£](https://pm2.keymetrics.io/docs/usage/quick-start/)
3. ğŸ“• [Nginx æ–‡æ¡£](https://nginx.org/en/docs/)

### å¿«é€Ÿé“¾æ¥
- [å¿«é€Ÿéƒ¨ç½²æŒ‡å—](./QUICK_DEPLOY.md)
- [å®Œæ•´éƒ¨ç½²æ–‡æ¡£](./DEPLOYMENT.md)
- [æ£€æŸ¥æ¸…å•](./BUILD_CHECKLIST.md)

### å¸¸è§é—®é¢˜
æŸ¥çœ‹ [DEPLOYMENT.md](./DEPLOYMENT.md) ä¸­çš„"å¸¸è§é—®é¢˜"ç« èŠ‚

---

## âœ… éƒ¨ç½²æˆåŠŸæ ‡å¿—

éƒ¨ç½²æˆåŠŸåï¼Œä½ åº”è¯¥èƒ½å¤Ÿï¼š
- âœ… è®¿é—®ç½‘ç«™é¦–é¡µ
- âœ… ä¸Šä¼ æ–‡ä»¶å¹¶åˆ†æ
- âœ… æŸ¥çœ‹åˆ†æç»“æœ
- âœ… æŸ¥çœ‹äº§å“è¯¦æƒ…
- âœ… æŸ¥çœ‹é‡‡è´­æ–¹æ¡ˆæ€»ç»“
- âœ… æ‰€æœ‰åŠŸèƒ½æ­£å¸¸å·¥ä½œ

---

## ğŸ” å®‰å…¨æé†’

1. âœ… **ä½¿ç”¨ HTTPS**: ç”Ÿäº§ç¯å¢ƒå¿…é¡»å¯ç”¨
2. âœ… **ç¯å¢ƒå˜é‡**: ä¸è¦å°† `.env` æ–‡ä»¶æäº¤åˆ° Git
3. âœ… **å®šæœŸæ›´æ–°**: ä¿æŒä¾èµ–åŒ…æœ€æ–°
4. âœ… **è®¿é—®æ§åˆ¶**: é…ç½®é˜²ç«å¢™å’Œé™æµ
5. âœ… **å¤‡ä»½æ•°æ®**: å®šæœŸå¤‡ä»½ä»£ç å’Œé…ç½®

---

## ğŸ“ æ›´æ–°æ—¥å¿—

- **2025-01-11**: åˆ›å»ºéƒ¨ç½²æ–‡æ¡£
- **2025-01-11**: æ·»åŠ ä¿å­˜ç¡®è®¤åŠŸèƒ½
- **2025-01-11**: å®Œå–„æ•°æ®é›†æˆ

---

**ç¥ä½ éƒ¨ç½²é¡ºåˆ©ï¼** ğŸ‰

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æŸ¥çœ‹è¯¦ç»†æ–‡æ¡£æˆ–è”ç³»æŠ€æœ¯æ”¯æŒã€‚

